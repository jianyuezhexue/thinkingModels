# 思维模型平台 - 技术方案

## 一、项目概述

基于项目蓝图，本技术方案设计一个完整的思维模型应用平台后端系统。系统采用 Go + Gin 框架，遵循简化分层架构，实现思维模型的创建、发布、交易、课题分析、行动跟踪和社群交流等核心功能。

---

## 二、领域划分

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              思维模型平台 - 领域划分                              │
└─────────────────────────────────────────────────────────────────────────────────┘

┌──────────┐  ┌──────────┐  ┌──────────────────────────────┐  ┌──────────┐  ┌──────────┐
│   iam    │  │  master  │  │         thinking             │  │  ai  │  │  payment │
│ 身份认证 │  │ 基础数据 │  │    思维模型核心（MVP）        │  │  AI对话  │  │ 支付中心 │
└────┬─────┘  └────┬─────┘  └──────────────┬───────────────┘  └────┬─────┘  └────┬─────┘
     │             │                       │                       │             │
     ▼             ▼                       ▼                       ▼             ▼
┌─────────┐  ┌─────────┐  ┌────────────────────────────────┐  ┌─────────┐  ┌─────────┐
│ • user  │  │• superD │  │ • model    (思维模型)          │  │ • chat  │  │ • order │
│         │  │• region │  │ • category (模型分类)          │  │ • log   │  │ • wallet│
│         │  │         │  │ • topic    (课题管理)          │  │ • agent │  │ • settle│
│         │  │         │  │ • analysis (分析记录)          │  │ • config│  │         │
│         │  │         │  │ • action   (行动清单)          │  │         │  │         │
│         │  │         │  │ • followup (跟进记录)          │  │         │  │         │
└─────────┘  └─────────┘  └────────────────────────────────┘  └─────────┘  └─────────┘

┌──────────────────────────────────────────────────────────────────────────────────┐
│                              community - 智性社群（可扩展）                        │
├──────────────────────────────────────────────────────────────────────────────────┤
│ • meetup (约见活动)  • discuss (话题讨论)  • consult (付费咨询)  • [未来扩展...]  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

### 2.1 领域职责说明

| 领域 | 路径 | 职责描述 | 优先级 |
|------|------|----------|--------|
| **iam** | `domain/iam/` | 身份与访问管理：用户注册登录、Token管理 | P0 |
| **master** | `domain/master/` | 基础数据管理：超级字典、系统配置 | P0 |
| **thinking** | `domain/thinking/` | 🌟 **核心MVP**：思维模型市场、课题分析、行动管理完整闭环 | P0 |
| **ai** | `domain/ai/` | AI对话基础设施：多模型支持、对话日志、智能体配置（基于eino框架） | P0 |
| **payment** | `domain/payment/` | 支付中心：订单管理、钱包账户、收益结算 | P1 |
| **community** | `domain/community/` | 智性社群：约见活动、话题讨论、付费咨询（可扩展） | P2 |

---

## 三、业务模型设计

### 3.1 领域实体总览

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              业务模型关联关系图                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────┐
                              │   UserEntity    │
                              │     (用户)      │
                              └────────┬────────┘
                                       │
           ┌───────────────────────────┼───────────────────────────┐
           │                           │                           │
           ▼                           ▼                           ▼
┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐
│  ModelEntity    │◄────────│  TopicEntity    │────────►│  ActionEntity   │
│   (思维模型)    │         │     (课题)      │         │     (行动)      │
└────────┬────────┘         └────────┬────────┘         └────────┬────────┘
         │                           │                           │
         │                           ▼                           ▼
         │                  ┌─────────────────┐         ┌─────────────────┐
         │                  │ AnalysisEntity  │         │FollowUpEntity   │
         │                  │   (分析记录)    │         │   (跟进记录)    │
         │                  └─────────────────┘         └─────────────────┘
         │
         ▼
┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐
│ CategoryEntity  │         │  OrderEntity    │         │  WalletEntity   │
│   (模型分类)    │         │  (订单/采纳)    │         │   (钱包账户)    │
└─────────────────┘         └─────────────────┘         └─────────────────┘

                              社群模块实体
┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐
│  MeetupEntity   │         │ DiscussEntity   │         │ ConsultEntity   │
│   (约见活动)    │         │   (话题讨论)    │         │   (付费咨询)    │
└─────────────────┘         └─────────────────┘         └─────────────────┘
```

### 3.2 各领域业务模型详细说明

#### 3.2.1 iam - 身份认证领域

| 实体 | 表名 | 业务功能 | 核心能力 |
|------|------|----------|----------|
| **UserEntity** | users | 用户账户管理 | 注册、登录、密码加密验证、Token生成刷新、登录状态管理 |

#### 3.2.2 master - 基础数据领域

| 实体 | 表名 | 业务功能 | 核心能力 |
|------|------|----------|----------|
| **SuperDictionaryEntity** | super_dictionary | 超级字典 | 多级字典树管理、字典值获取、扩展配置 |
| **RegionEntity** | region | 省市区 | 行政区划树管理、按级别查询、经纬度坐标、邮编查询 |

#### 3.2.3 thinking - 思维模型核心领域（MVP）

| 实体 | 表名 | 业务功能 | 核心能力 |
|------|------|----------|----------|
| **ModelEntity** | thinking_models | 思维模型管理 | 模型创建编辑、内容版本管理、发布上下架、使用统计 |
| **CategoryEntity** | model_categories | 模型分类 | 分类树管理、排序调整、状态控制 |
| **ModelTagEntity** | model_tags | 模型标签 | 标签管理、热门标签统计 |
| **ModelCommentEntity** | model_comments | 模型评论 | 评论发布、点赞、回复 |
| **TopicEntity** | topics | 课题管理 | 课题创建、状态流转(草稿/进行中/已完成/归档)、模型选用 |
| **AnalysisEntity** | topic_analyses | 分析记录 | 分析内容保存、AI分析调用、版本管理、历史记录 |
| **ActionEntity** | actions | 行动清单 | 行动创建、优先级设置、状态管理、截止日期、完成度跟踪 |
| **FollowUpEntity** | action_followups | 跟进记录 | 跟进内容记录、时间线展示、执行反馈 |

#### 3.2.4 ai - AI对话基础设施领域

| 实体 | 表名 | 业务功能 | 核心能力 |
|------|------|----------|----------|
| **ChatSessionEntity** | chat_sessions | 对话会话 | 会话创建、上下文管理、会话归档 |
| **ChatMessageEntity** | chat_messages | 对话消息 | 消息存储、流式响应、消息历史 |
| **ChatLogEntity** | chat_logs | 对话日志 | 输入输出记录、Token统计、系统提示词记录 |
| **AiModelConfigEntity** | ai_model_configs | 模型配置 | 多模型管理、用户自定义配置、API密钥管理 |
| **UserAiConfigEntity** | user_ai_configs | 用户AI配置 | 用户模型偏好、自定义API配置 |
| **AgentEntity** | agents | 智能体 | 智能体配置、工具链管理、提示词模板（基于eino框架）|
| **UserTokenUsageEntity** | user_token_usages | Token消耗 | 按用户统计Token消耗、配额管理 |

#### 3.2.5 payment - 支付中心领域

| 实体 | 表名 | 业务功能 | 核心能力 |
|------|------|----------|----------|
| **OrderEntity** | orders | 订单管理 | 订单创建、支付处理、退款、状态流转 |
| **WalletEntity** | wallets | 钱包账户 | 账户余额、充值提现、交易流水 |
| **WalletTransactionEntity** | wallet_transactions | 钱包流水 | 收入支出记录、交易明细 |
| **SettlementEntity** | settlements | 结算记录 | 收益结算、T+7结算、提现审核 |

#### 3.2.6 community - 智性社群领域（可扩展）

| 实体 | 表名 | 业务功能 | 核心能力 |
|------|------|----------|----------|
| **MeetupEntity** | meetups | 找人聊聊 | 约见发起、报名参与、状态管理、城市筛选 |
| **MeetupApplyEntity** | meetup_applies | 约见报名 | 报名申请、确认拒绝、人数控制 |
| **DiscussEntity** | discussions | 话题讨论 | 话题发布、分类管理、点赞收藏、置顶精华 |
| **DiscussCommentEntity** | discuss_comments | 话题评论 | 评论回复、点赞互动 |
| **ConsultEntity** | consultations | 付费咨询 | 咨询发布、悬赏设置、专家申请、匹配确认 |
| **ConsultApplyEntity** | consult_applies | 咨询申请 | 专家申请、选中确认、完成评价 |

---

## 四、数据库设计

### 4.1 iam 领域表结构

```sql
-- ========================================
-- IAM 领域 - 用户表
-- ========================================
CREATE TABLE `users` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `username` VARCHAR(50) NOT NULL COMMENT '登录用户名',
    `password` VARCHAR(255) NOT NULL COMMENT '加密密码',
    `nickname` VARCHAR(100) DEFAULT '' COMMENT '用户昵称',
    `email` VARCHAR(100) DEFAULT '' COMMENT '邮箱',
    `phone` VARCHAR(20) DEFAULT '' COMMENT '手机号',
    `avatar` VARCHAR(500) DEFAULT '' COMMENT '头像URL',
    `bio` VARCHAR(500) DEFAULT '' COMMENT '个人简介',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态:0=禁用,1=正常',
    `last_login_time` DATETIME DEFAULT NULL COMMENT '最后登录时间',
    `last_login_ip` VARCHAR(50) DEFAULT '' COMMENT '最后登录IP',
    `enterprise_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '企业ID',
    `role_ids` VARCHAR(200) DEFAULT '' COMMENT '角色ID列表',
    `is_expert` TINYINT DEFAULT 0 COMMENT '是否专家:0=否,1=是',
    `expert_title` VARCHAR(100) DEFAULT '' COMMENT '专家头衔',
    `expert_company` VARCHAR(100) DEFAULT '' COMMENT '所属公司',
    `expert_domains` VARCHAR(500) DEFAULT '' COMMENT '专业领域',
    `consult_price` DECIMAL(10,2) DEFAULT 0 COMMENT '咨询价格',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_username` (`username`),
    KEY `idx_phone` (`phone`),
    KEY `idx_email` (`email`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';

```

### 4.2 master 领域表结构

```sql
-- ========================================
-- MASTER 领域 - 超级字典表
-- ========================================
CREATE TABLE `super_dictionary` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `parent_id` BIGINT DEFAULT 0 COMMENT '父级ID',
    `dict_value` VARCHAR(100) NOT NULL COMMENT '字典值',
    `dict_name` VARCHAR(100) NOT NULL COMMENT '字典名称',
    `level` INT DEFAULT 1 COMMENT '层级',
    `level_name` VARCHAR(50) DEFAULT '' COMMENT '层级名称',
    `description` VARCHAR(500) DEFAULT '' COMMENT '字典描述',
    `eval` VARCHAR(200) DEFAULT '' COMMENT '计算表达式',
    `ext_schema` TEXT COMMENT '扩展Schema',
    `ext_json` TEXT COMMENT '扩展JSON',
    `sort` INT DEFAULT 0 COMMENT '排序',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=禁用,1=正常',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_parent_id` (`parent_id`),
    KEY `idx_dict_value` (`dict_value`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='超级字典表';

-- 省市区表
CREATE TABLE `region` (
    `id` INT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `parent_id` INT NOT NULL DEFAULT 0 COMMENT '父级ID',
    `name` VARCHAR(50) NOT NULL COMMENT '区域名称',
    `level` INT NOT NULL COMMENT '层级:1=省,2=市,3=区县',
    `postal_code` VARCHAR(50) DEFAULT '' COMMENT '邮政编码',
    `longitude` VARCHAR(50) DEFAULT '' COMMENT '经度',
    `latitude` VARCHAR(50) DEFAULT '' COMMENT '纬度',
    `adcode` INT DEFAULT NULL COMMENT '区域编号(国标)',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL COMMENT '更新时间',
    PRIMARY KEY (`id`),
    KEY `idx_adcode` (`adcode`),
    KEY `idx_level_parent_id` (`parent_id`, `level`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='省市区表';
```

### 4.3 thinking 领域表结构（核心MVP）

```sql
-- ========================================
-- THINKING 领域 - 思维模型表
-- ========================================
CREATE TABLE `thinking_models` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `name` VARCHAR(100) NOT NULL COMMENT '模型名称',
    `code` VARCHAR(50) NOT NULL COMMENT '模型编码',
    `description` VARCHAR(1000) DEFAULT '' COMMENT '模型描述',
    `cover_image` VARCHAR(500) DEFAULT '' COMMENT '封面图片URL',
    `icon` VARCHAR(200) DEFAULT '' COMMENT '模型图标',
    `category_id` BIGINT UNSIGNED NOT NULL COMMENT '所属分类ID',
    `price` DECIMAL(10,2) DEFAULT 0 COMMENT '价格，0表示免费',
    `content` LONGTEXT COMMENT '模型内容JSON',
    `overview` TEXT COMMENT '模型概述',
    `difficulty` TINYINT DEFAULT 1 COMMENT '难度:1=入门,2=进阶,3=高级',
    `estimated_time` INT DEFAULT 30 COMMENT '预计完成时间(分钟)',
    `usage_count` INT DEFAULT 0 COMMENT '使用次数',
    `adopt_count` INT DEFAULT 0 COMMENT '采纳次数',
    `like_count` INT DEFAULT 0 COMMENT '点赞次数',
    `comment_count` INT DEFAULT 0 COMMENT '评论次数',
    `status` TINYINT DEFAULT 0 COMMENT '状态:0=草稿,1=审核中,2=已发布,3=已下架,4=审核拒绝',
    `publish_time` DATETIME DEFAULT NULL COMMENT '发布时间',
    `version` VARCHAR(20) DEFAULT '1.0.0' COMMENT '版本号',
    `author_id` BIGINT UNSIGNED NOT NULL COMMENT '作者ID',
    `author_name` VARCHAR(100) DEFAULT '' COMMENT '作者名称',
    `is_official` TINYINT DEFAULT 0 COMMENT '是否官方:0=否,1=是',
    `source_model_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '引用源模型ID',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_code` (`code`),
    KEY `idx_category_id` (`category_id`),
    KEY `idx_author_id` (`author_id`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='思维模型表';

-- 模型分类表
CREATE TABLE `model_categories` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `parent_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '父分类ID',
    `name` VARCHAR(50) NOT NULL COMMENT '分类名称',
    `code` VARCHAR(50) NOT NULL COMMENT '分类编码',
    `icon` VARCHAR(100) DEFAULT '' COMMENT '分类图标',
    `description` VARCHAR(200) DEFAULT '' COMMENT '分类描述',
    `sort` INT DEFAULT 0 COMMENT '排序',
    `level` INT DEFAULT 1 COMMENT '层级',
    `path` VARCHAR(500) DEFAULT '' COMMENT '路径',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=禁用,1=正常',
    `model_count` INT DEFAULT 0 COMMENT '模型数量',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_code` (`code`),
    KEY `idx_parent_id` (`parent_id`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='模型分类表';

-- 模型标签表
CREATE TABLE `model_tags` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `model_id` BIGINT UNSIGNED NOT NULL COMMENT '模型ID',
    `tag_name` VARCHAR(50) NOT NULL COMMENT '标签名称',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    PRIMARY KEY (`id`),
    KEY `idx_model_id` (`model_id`),
    KEY `idx_tag_name` (`tag_name`),
    KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='模型标签表';

-- 模型评论表  
CREATE TABLE `model_comments` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `model_id` BIGINT UNSIGNED NOT NULL COMMENT '模型ID',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '评论用户ID',
    `user_name` VARCHAR(100) DEFAULT '' COMMENT '用户名称',
    `user_avatar` VARCHAR(500) DEFAULT '' COMMENT '用户头像',
    `content` VARCHAR(1000) NOT NULL COMMENT '评论内容',
    `parent_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '父评论ID',
    `reply_to_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '回复目标用户ID',
    `like_count` INT DEFAULT 0 COMMENT '点赞数',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=隐藏,1=显示',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_model_id` (`model_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_parent_id` (`parent_id`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='模型评论表';
```

### 4.3.2 thinking 领域 - 课题与分析子模块

```sql
-- ========================================
-- THINKING 领域 - 课题表
-- ========================================
CREATE TABLE `topics` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `title` VARCHAR(200) NOT NULL COMMENT '课题标题',
    `description` TEXT COMMENT '课题描述',
    `background` TEXT COMMENT '背景说明',
    `goal` TEXT COMMENT '目标设定',
    `constraints` TEXT COMMENT '约束条件',
    `status` TINYINT DEFAULT 0 COMMENT '状态:0=草稿,1=进行中,2=已完成,3=已归档',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '所属用户ID',
    `model_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '当前使用的思维模型ID',
    `model_name` VARCHAR(100) DEFAULT '' COMMENT '模型名称快照',
    `priority` TINYINT DEFAULT 2 COMMENT '优先级:1=低,2=中,3=高',
    `tags` VARCHAR(500) DEFAULT '' COMMENT '标签，逗号分隔',
    `analysis_count` INT DEFAULT 0 COMMENT '分析次数',
    `action_count` INT DEFAULT 0 COMMENT '导出行动数',
    `deadline` DATETIME DEFAULT NULL COMMENT '截止日期',
    `complete_time` DATETIME DEFAULT NULL COMMENT '完成时间',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_model_id` (`model_id`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='课题表';

-- 课题分析记录表
CREATE TABLE `topic_analyses` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `topic_id` BIGINT UNSIGNED NOT NULL COMMENT '所属课题ID',
    `model_id` BIGINT UNSIGNED NOT NULL COMMENT '使用的思维模型ID',
    `model_name` VARCHAR(100) DEFAULT '' COMMENT '模型名称快照',
    `content` LONGTEXT COMMENT '用户填写的分析内容JSON',
    `ai_analysis` LONGTEXT COMMENT 'AI分析结果',
    `ai_suggestions` TEXT COMMENT 'AI建议',
    `version` INT DEFAULT 1 COMMENT '版本号',
    `is_current` TINYINT DEFAULT 1 COMMENT '是否当前版本:0=否,1=是',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `status` TINYINT DEFAULT 0 COMMENT '状态:0=分析中,1=已完成,2=失败',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_topic_id` (`topic_id`),
    KEY `idx_model_id` (`model_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='课题分析记录表';
```

### 4.3.3 thinking 领域 - 行动管理子模块

```sql
-- ========================================
-- THINKING 领域 - 行动表
-- ========================================
CREATE TABLE `actions` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `title` VARCHAR(200) NOT NULL COMMENT '行动标题',
    `description` TEXT COMMENT '行动描述',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '所属用户ID',
    `topic_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '关联课题ID',
    `topic_title` VARCHAR(200) DEFAULT '' COMMENT '课题标题快照',
    `analysis_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '来源分析ID',
    `priority` TINYINT DEFAULT 2 COMMENT '优先级:1=低,2=中,3=高',
    `status` TINYINT DEFAULT 0 COMMENT '状态:0=待执行,1=进行中,2=已完成,3=已取消',
    `progress` INT DEFAULT 0 COMMENT '完成进度(0-100)',
    `deadline` DATETIME DEFAULT NULL COMMENT '截止日期',
    `complete_time` DATETIME DEFAULT NULL COMMENT '完成时间',
    `guide_principle` TEXT COMMENT '指导原则(来自思维模型)',
    `followup_count` INT DEFAULT 0 COMMENT '跟进记录数',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_topic_id` (`topic_id`),
    KEY `idx_status` (`status`),
    KEY `idx_priority` (`priority`),
    KEY `idx_deadline` (`deadline`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='行动表';

-- 行动跟进记录表
CREATE TABLE `action_followups` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `action_id` BIGINT UNSIGNED NOT NULL COMMENT '所属行动ID',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `content` TEXT NOT NULL COMMENT '跟进内容',
    `progress_before` INT DEFAULT 0 COMMENT '跟进前进度',
    `progress_after` INT DEFAULT 0 COMMENT '跟进后进度',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_action_id` (`action_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='行动跟进记录表';
```

### 4.4 ai 领域表结构（AI对话基础设施）

```sql
-- ========================================
-- AI 领域 - 对话会话表
-- ========================================
CREATE TABLE `chat_sessions` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `title` VARCHAR(200) DEFAULT '新对话' COMMENT '会话标题',
    `scene` VARCHAR(50) DEFAULT 'general' COMMENT '场景:general=通用,topic=课题分析,action=行动规划',
    `model_config_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '使用的模型配置ID',
    `model_name` VARCHAR(100) DEFAULT '' COMMENT '模型名称',
    `agent_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '关联智能体ID',
    `system_prompt` TEXT COMMENT '系统提示词',
    `context` LONGTEXT COMMENT '上下文（JSON格式，包含关联的课题、模型等）',
    `message_count` INT DEFAULT 0 COMMENT '消息数量',
    `total_tokens` INT DEFAULT 0 COMMENT '累计Token消耗',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=已归档,1=活跃',
    `last_message_at` DATETIME DEFAULT NULL COMMENT '最后消息时间',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_scene` (`scene`),
    KEY `idx_agent_id` (`agent_id`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='对话会话表';

-- 对话消息表
CREATE TABLE `chat_messages` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `session_id` BIGINT UNSIGNED NOT NULL COMMENT '会话ID',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `role` VARCHAR(20) NOT NULL COMMENT '角色:user/assistant/system',
    `content` LONGTEXT NOT NULL COMMENT '消息内容',
    `content_type` VARCHAR(20) DEFAULT 'text' COMMENT '内容类型:text/markdown/json',
    `parent_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '父消息ID（用于消息分支）',
    `model_name` VARCHAR(100) DEFAULT '' COMMENT '使用的模型',
    `input_tokens` INT DEFAULT 0 COMMENT '输入Token数',
    `output_tokens` INT DEFAULT 0 COMMENT '输出Token数',
    `total_tokens` INT DEFAULT 0 COMMENT '总Token数',
    `latency_ms` INT DEFAULT 0 COMMENT '响应延迟(毫秒)',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=失败,1=成功,2=生成中',
    `error_msg` VARCHAR(500) DEFAULT '' COMMENT '错误信息',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_session_id` (`session_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_role` (`role`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='对话消息表';

-- 对话日志表（详细记录，用于分析和审计）
CREATE TABLE `chat_logs` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `session_id` BIGINT UNSIGNED NOT NULL COMMENT '会话ID',
    `message_id` BIGINT UNSIGNED NOT NULL COMMENT '消息ID',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `model_provider` VARCHAR(50) DEFAULT '' COMMENT '模型提供商:openai/anthropic/azure/custom',
    `model_name` VARCHAR(100) NOT NULL COMMENT '模型名称',
    `model_version` VARCHAR(50) DEFAULT '' COMMENT '模型版本',
    `request_id` VARCHAR(100) DEFAULT '' COMMENT '请求ID',
    `system_prompt` TEXT COMMENT '系统提示词',
    `user_input` LONGTEXT NOT NULL COMMENT '用户输入',
    `assistant_output` LONGTEXT COMMENT 'AI输出',
    `context_messages` LONGTEXT COMMENT '上下文消息JSON',
    `input_tokens` INT DEFAULT 0 COMMENT '输入Token数',
    `output_tokens` INT DEFAULT 0 COMMENT '输出Token数',
    `total_tokens` INT DEFAULT 0 COMMENT '总Token数',
    `cost_amount` DECIMAL(10,6) DEFAULT 0 COMMENT '本次调用成本(美元)',
    `latency_ms` INT DEFAULT 0 COMMENT '响应延迟(毫秒)',
    `temperature` DECIMAL(3,2) DEFAULT 0.7 COMMENT '温度参数',
    `max_tokens` INT DEFAULT 0 COMMENT '最大Token数限制',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=失败,1=成功',
    `error_code` VARCHAR(50) DEFAULT '' COMMENT '错误码',
    `error_msg` TEXT COMMENT '错误信息',
    `raw_request` LONGTEXT COMMENT '原始请求JSON',
    `raw_response` LONGTEXT COMMENT '原始响应JSON',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_session_id` (`session_id`),
    KEY `idx_message_id` (`message_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_model_name` (`model_name`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='对话日志表';

-- AI模型配置表（系统预设模型）
CREATE TABLE `ai_model_configs` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `name` VARCHAR(100) NOT NULL COMMENT '配置名称',
    `code` VARCHAR(50) NOT NULL COMMENT '配置编码',
    `provider` VARCHAR(50) NOT NULL COMMENT '提供商:openai/anthropic/azure/deepseek/doubao/custom',
    `model_name` VARCHAR(100) NOT NULL COMMENT '模型名称',
    `api_base_url` VARCHAR(500) DEFAULT '' COMMENT 'API基础URL',
    `api_key_encrypted` VARCHAR(500) DEFAULT '' COMMENT '加密的API Key（系统预设）',
    `description` VARCHAR(500) DEFAULT '' COMMENT '模型描述',
    `icon` VARCHAR(200) DEFAULT '' COMMENT '模型图标',
    `max_tokens` INT DEFAULT 4096 COMMENT '最大Token数',
    `input_price` DECIMAL(10,6) DEFAULT 0 COMMENT '输入价格(美元/1K tokens)',
    `output_price` DECIMAL(10,6) DEFAULT 0 COMMENT '输出价格(美元/1K tokens)',
    `default_temperature` DECIMAL(3,2) DEFAULT 0.7 COMMENT '默认温度',
    `supports_streaming` TINYINT DEFAULT 1 COMMENT '是否支持流式:0=否,1=是',
    `supports_function` TINYINT DEFAULT 0 COMMENT '是否支持函数调用:0=否,1=是',
    `supports_vision` TINYINT DEFAULT 0 COMMENT '是否支持图片:0=否,1=是',
    `is_default` TINYINT DEFAULT 0 COMMENT '是否默认模型:0=否,1=是',
    `sort` INT DEFAULT 0 COMMENT '排序',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=禁用,1=启用',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_code` (`code`),
    KEY `idx_provider` (`provider`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='AI模型配置表';

-- 用户AI配置表（用户自定义模型配置）
CREATE TABLE `user_ai_configs` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `name` VARCHAR(100) NOT NULL COMMENT '配置名称',
    `provider` VARCHAR(50) NOT NULL COMMENT '提供商',
    `model_name` VARCHAR(100) NOT NULL COMMENT '模型名称',
    `api_base_url` VARCHAR(500) NOT NULL COMMENT 'API基础URL',
    `api_key_encrypted` VARCHAR(500) NOT NULL COMMENT '加密的API Key',
    `max_tokens` INT DEFAULT 4096 COMMENT '最大Token数',
    `default_temperature` DECIMAL(3,2) DEFAULT 0.7 COMMENT '默认温度',
    `is_default` TINYINT DEFAULT 0 COMMENT '是否用户默认:0=否,1=是',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=禁用,1=启用',
    `last_used_at` DATETIME DEFAULT NULL COMMENT '最后使用时间',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_provider` (`provider`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户AI配置表';

-- 智能体表（基于eino框架）
CREATE TABLE `agents` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `name` VARCHAR(100) NOT NULL COMMENT '智能体名称',
    `code` VARCHAR(50) NOT NULL COMMENT '智能体编码',
    `description` VARCHAR(500) DEFAULT '' COMMENT '智能体描述',
    `icon` VARCHAR(200) DEFAULT '' COMMENT '图标',
    `scene` VARCHAR(50) DEFAULT 'general' COMMENT '使用场景:general/topic/action/consult',
    `model_config_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '默认模型配置ID',
    `system_prompt` LONGTEXT COMMENT '系统提示词模板',
    `welcome_message` VARCHAR(500) DEFAULT '' COMMENT '欢迎语',
    `suggested_questions` TEXT COMMENT '推荐问题JSON数组',
    `tools_config` LONGTEXT COMMENT '工具链配置JSON（eino框架工具配置）',
    `retriever_config` LONGTEXT COMMENT '检索器配置JSON（RAG配置）',
    `flow_config` LONGTEXT COMMENT '流程配置JSON（eino flow配置）',
    `variables` TEXT COMMENT '变量定义JSON',
    `max_turns` INT DEFAULT 20 COMMENT '最大对话轮数',
    `is_official` TINYINT DEFAULT 0 COMMENT '是否官方:0=否,1=是',
    `is_public` TINYINT DEFAULT 1 COMMENT '是否公开:0=否,1=是',
    `author_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '创建者ID',
    `usage_count` INT DEFAULT 0 COMMENT '使用次数',
    `sort` INT DEFAULT 0 COMMENT '排序',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=禁用,1=启用',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_code` (`code`),
    KEY `idx_scene` (`scene`),
    KEY `idx_author_id` (`author_id`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='智能体表';

-- 用户Token消耗统计表
CREATE TABLE `user_token_usages` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `date` DATE NOT NULL COMMENT '统计日期',
    `model_name` VARCHAR(100) DEFAULT '' COMMENT '模型名称（空表示汇总）',
    `input_tokens` BIGINT DEFAULT 0 COMMENT '输入Token数',
    `output_tokens` BIGINT DEFAULT 0 COMMENT '输出Token数',
    `total_tokens` BIGINT DEFAULT 0 COMMENT '总Token数',
    `request_count` INT DEFAULT 0 COMMENT '请求次数',
    `cost_amount` DECIMAL(10,4) DEFAULT 0 COMMENT '成本金额(美元)',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_user_date_model` (`user_id`, `date`, `model_name`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_date` (`date`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户Token消耗统计表';
```

### 4.5 payment 领域表结构（支付中心）

```sql
-- ========================================
-- PAYMENT 领域 - 订单表
-- ========================================
CREATE TABLE `orders` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `order_no` VARCHAR(50) NOT NULL COMMENT '订单编号',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `order_type` TINYINT DEFAULT 1 COMMENT '订单类型:1=模型采纳(含免费),2=付费咨询,3=余额充值,4=Token购买',
    `target_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '目标ID(模型ID/咨询ID等)',
    `target_name` VARCHAR(200) DEFAULT '' COMMENT '目标名称',
    `amount` DECIMAL(10,2) NOT NULL COMMENT '订单金额(免费采纳为0)',
    `discount_amount` DECIMAL(10,2) DEFAULT 0 COMMENT '优惠金额',
    `pay_amount` DECIMAL(10,2) DEFAULT 0 COMMENT '实付金额',
    `platform_fee` DECIMAL(10,2) DEFAULT 0 COMMENT '平台服务费',
    `seller_income` DECIMAL(10,2) DEFAULT 0 COMMENT '卖家收入',
    `seller_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '卖家ID',
    `status` TINYINT DEFAULT 0 COMMENT '状态:0=待支付,1=已支付,2=已完成,3=已退款,4=已取消,5=支付失败',
    `is_hidden` TINYINT DEFAULT 0 COMMENT '是否隐藏:0=显示,1=隐藏(用于移除采纳)',
    `pay_channel` VARCHAR(20) DEFAULT '' COMMENT '支付渠道:wechat/alipay/wallet',
    `pay_method` VARCHAR(20) DEFAULT '' COMMENT '支付方式',
    `pay_trade_no` VARCHAR(100) DEFAULT '' COMMENT '支付流水号',
    `pay_time` DATETIME DEFAULT NULL COMMENT '支付时间',
    `expire_time` DATETIME DEFAULT NULL COMMENT '订单过期时间',
    `complete_time` DATETIME DEFAULT NULL COMMENT '完成时间',
    `refund_time` DATETIME DEFAULT NULL COMMENT '退款时间',
    `refund_amount` DECIMAL(10,2) DEFAULT 0 COMMENT '退款金额',
    `refund_reason` VARCHAR(500) DEFAULT '' COMMENT '退款原因',
    `settle_status` TINYINT DEFAULT 0 COMMENT '结算状态:0=未结算,1=已结算',
    `settle_time` DATETIME DEFAULT NULL COMMENT '结算时间',
    `remark` VARCHAR(500) DEFAULT '' COMMENT '备注',
    `extra_data` TEXT COMMENT '扩展数据JSON',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_order_no` (`order_no`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_seller_id` (`seller_id`),
    KEY `idx_order_type` (`order_type`),
    KEY `idx_status` (`status`),
    KEY `idx_pay_time` (`pay_time`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='订单表';

-- 钱包账户表
CREATE TABLE `wallets` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `balance` DECIMAL(12,2) DEFAULT 0 COMMENT '可用余额',
    `frozen_balance` DECIMAL(12,2) DEFAULT 0 COMMENT '冻结金额',
    `total_income` DECIMAL(12,2) DEFAULT 0 COMMENT '累计收入',
    `total_expense` DECIMAL(12,2) DEFAULT 0 COMMENT '累计支出',
    `total_withdraw` DECIMAL(12,2) DEFAULT 0 COMMENT '累计提现',
    `token_balance` BIGINT DEFAULT 0 COMMENT 'Token余额',
    `token_used` BIGINT DEFAULT 0 COMMENT '已使用Token',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=冻结,1=正常',
    `password_hash` VARCHAR(200) DEFAULT '' COMMENT '支付密码哈希',
    `last_transaction_at` DATETIME DEFAULT NULL COMMENT '最后交易时间',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_user_id` (`user_id`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='钱包账户表';

-- 钱包交易流水表
CREATE TABLE `wallet_transactions` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `transaction_no` VARCHAR(50) NOT NULL COMMENT '流水号',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `wallet_id` BIGINT UNSIGNED NOT NULL COMMENT '钱包ID',
    `type` TINYINT NOT NULL COMMENT '类型:1=充值,2=消费,3=收入,4=提现,5=退款,6=冻结,7=解冻',
    `amount` DECIMAL(12,2) NOT NULL COMMENT '交易金额',
    `balance_before` DECIMAL(12,2) DEFAULT 0 COMMENT '交易前余额',
    `balance_after` DECIMAL(12,2) DEFAULT 0 COMMENT '交易后余额',
    `order_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '关联订单ID',
    `order_no` VARCHAR(50) DEFAULT '' COMMENT '关联订单号',
    `related_user_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '关联用户ID(收款人/付款人)',
    `title` VARCHAR(200) DEFAULT '' COMMENT '交易标题',
    `description` VARCHAR(500) DEFAULT '' COMMENT '交易描述',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=失败,1=成功,2=处理中',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_transaction_no` (`transaction_no`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_wallet_id` (`wallet_id`),
    KEY `idx_type` (`type`),
    KEY `idx_order_id` (`order_id`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='钱包交易流水表';

-- 结算记录表
CREATE TABLE `settlements` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `settlement_no` VARCHAR(50) NOT NULL COMMENT '结算单号',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
    `settle_type` TINYINT DEFAULT 1 COMMENT '结算类型:1=自动结算,2=手动提现',
    `period_start` DATE DEFAULT NULL COMMENT '结算周期开始',
    `period_end` DATE DEFAULT NULL COMMENT '结算周期结束',
    `order_count` INT DEFAULT 0 COMMENT '订单数量',
    `gross_amount` DECIMAL(12,2) DEFAULT 0 COMMENT '订单总额',
    `platform_fee` DECIMAL(12,2) DEFAULT 0 COMMENT '平台服务费',
    `settle_amount` DECIMAL(12,2) NOT NULL COMMENT '结算金额',
    `bank_name` VARCHAR(100) DEFAULT '' COMMENT '银行名称',
    `bank_account` VARCHAR(50) DEFAULT '' COMMENT '银行账号',
    `bank_holder` VARCHAR(50) DEFAULT '' COMMENT '账户名',
    `status` TINYINT DEFAULT 0 COMMENT '状态:0=待审核,1=审核通过,2=已打款,3=已完成,4=已拒绝',
    `audit_user_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '审核人ID',
    `audit_time` DATETIME DEFAULT NULL COMMENT '审核时间',
    `audit_remark` VARCHAR(500) DEFAULT '' COMMENT '审核备注',
    `pay_time` DATETIME DEFAULT NULL COMMENT '打款时间',
    `pay_trade_no` VARCHAR(100) DEFAULT '' COMMENT '打款流水号',
    `complete_time` DATETIME DEFAULT NULL COMMENT '完成时间',
    `remark` VARCHAR(500) DEFAULT '' COMMENT '备注',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_settlement_no` (`settlement_no`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_status` (`status`),
    KEY `idx_period_start` (`period_start`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='结算记录表';
```

### 4.6 community 领域表结构（可扩展）

```sql
-- ========================================
-- COMMUNITY 领域 - 约见活动表
-- ========================================
CREATE TABLE `meetups` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `title` VARCHAR(200) NOT NULL COMMENT '约见标题',
    `description` TEXT COMMENT '约见描述',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '发起人ID',
    `user_name` VARCHAR(100) DEFAULT '' COMMENT '发起人名称',
    `user_avatar` VARCHAR(500) DEFAULT '' COMMENT '发起人头像',
    `user_bio` VARCHAR(500) DEFAULT '' COMMENT '发起人简介',
    `topic_type` VARCHAR(50) DEFAULT '' COMMENT '主题类型',
    `city` VARCHAR(50) NOT NULL COMMENT '城市',
    `location` VARCHAR(200) DEFAULT '' COMMENT '具体地点',
    `preferred_time` VARCHAR(200) DEFAULT '' COMMENT '时间偏好',
    `meet_time` DATETIME DEFAULT NULL COMMENT '约定时间',
    `fee_type` TINYINT DEFAULT 1 COMMENT '费用方式:1=我请客,2=AA制,3=你请客',
    `max_people` INT DEFAULT 1 COMMENT '最大人数',
    `current_people` INT DEFAULT 0 COMMENT '当前人数',
    `model_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '关联模型ID',
    `model_name` VARCHAR(100) DEFAULT '' COMMENT '关联模型名称',
    `tags` VARCHAR(500) DEFAULT '' COMMENT '标签',
    `status` TINYINT DEFAULT 0 COMMENT '状态:0=招募中,1=待确认,2=已确认,3=已完成,4=已取消',
    `interest_count` INT DEFAULT 0 COMMENT '感兴趣数',
    `view_count` INT DEFAULT 0 COMMENT '浏览数',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_city` (`city`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='约见活动表';

-- 约见报名表
CREATE TABLE `meetup_applies` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `meetup_id` BIGINT UNSIGNED NOT NULL COMMENT '约见ID',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '报名用户ID',
    `user_name` VARCHAR(100) DEFAULT '' COMMENT '用户名称',
    `user_avatar` VARCHAR(500) DEFAULT '' COMMENT '用户头像',
    `message` VARCHAR(500) DEFAULT '' COMMENT '报名留言',
    `status` TINYINT DEFAULT 0 COMMENT '状态:0=待确认,1=已确认,2=已拒绝,3=已取消',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_meetup_user` (`meetup_id`, `user_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='约见报名表';

-- 话题讨论表
CREATE TABLE `discussions` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `title` VARCHAR(200) NOT NULL COMMENT '话题标题',
    `content` LONGTEXT COMMENT '话题内容',
    `summary` VARCHAR(500) DEFAULT '' COMMENT '内容摘要',
    `cover_image` VARCHAR(500) DEFAULT '' COMMENT '封面图片',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '发布用户ID',
    `user_name` VARCHAR(100) DEFAULT '' COMMENT '用户名称',
    `user_avatar` VARCHAR(500) DEFAULT '' COMMENT '用户头像',
    `category` VARCHAR(50) DEFAULT '' COMMENT '分类:灵感/方法论/案例/问题/分享',
    `model_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '关联模型ID',
    `model_name` VARCHAR(100) DEFAULT '' COMMENT '关联模型名称',
    `tags` VARCHAR(500) DEFAULT '' COMMENT '标签',
    `view_count` INT DEFAULT 0 COMMENT '浏览数',
    `like_count` INT DEFAULT 0 COMMENT '点赞数',
    `comment_count` INT DEFAULT 0 COMMENT '评论数',
    `collect_count` INT DEFAULT 0 COMMENT '收藏数',
    `is_top` TINYINT DEFAULT 0 COMMENT '是否置顶:0=否,1=是',
    `is_essence` TINYINT DEFAULT 0 COMMENT '是否精华:0=否,1=是',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=草稿,1=已发布,2=已隐藏',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_category` (`category`),
    KEY `idx_status` (`status`),
    KEY `idx_is_top` (`is_top`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='话题讨论表';

-- 话题评论表
CREATE TABLE `discuss_comments` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `discuss_id` BIGINT UNSIGNED NOT NULL COMMENT '话题ID',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '评论用户ID',
    `user_name` VARCHAR(100) DEFAULT '' COMMENT '用户名称',
    `user_avatar` VARCHAR(500) DEFAULT '' COMMENT '用户头像',
    `content` VARCHAR(2000) NOT NULL COMMENT '评论内容',
    `parent_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '父评论ID',
    `reply_to_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '回复目标用户ID',
    `reply_to_name` VARCHAR(100) DEFAULT '' COMMENT '回复目标用户名',
    `like_count` INT DEFAULT 0 COMMENT '点赞数',
    `status` TINYINT DEFAULT 1 COMMENT '状态:0=隐藏,1=显示',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_discuss_id` (`discuss_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_parent_id` (`parent_id`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='话题评论表';

-- 付费咨询表
CREATE TABLE `consultations` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `title` VARCHAR(200) NOT NULL COMMENT '咨询标题',
    `description` TEXT COMMENT '咨询描述',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT '发布用户ID',
    `user_name` VARCHAR(100) DEFAULT '' COMMENT '用户名称',
    `user_avatar` VARCHAR(500) DEFAULT '' COMMENT '用户头像',
    `domain` VARCHAR(50) DEFAULT '' COMMENT '咨询领域',
    `reward` DECIMAL(10,2) NOT NULL COMMENT '悬赏金额',
    `consult_type` TINYINT DEFAULT 1 COMMENT '咨询方式:1=线上,2=线下,3=均可',
    `deadline` DATETIME DEFAULT NULL COMMENT '截止日期',
    `expert_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '匹配专家ID',
    `expert_name` VARCHAR(100) DEFAULT '' COMMENT '专家名称',
    `apply_count` INT DEFAULT 0 COMMENT '申请人数',
    `view_count` INT DEFAULT 0 COMMENT '浏览数',
    `status` TINYINT DEFAULT 0 COMMENT '状态:0=征集中,1=已匹配,2=进行中,3=已完成,4=已取消,5=已过期',
    `order_id` BIGINT UNSIGNED DEFAULT 0 COMMENT '关联订单ID',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_expert_id` (`expert_id`),
    KEY `idx_domain` (`domain`),
    KEY `idx_status` (`status`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='付费咨询表';

-- 咨询申请表
CREATE TABLE `consult_applies` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    -- ==================== 业务字段 ====================
    `consult_id` BIGINT UNSIGNED NOT NULL COMMENT '咨询ID',
    `expert_id` BIGINT UNSIGNED NOT NULL COMMENT '专家用户ID',
    `expert_name` VARCHAR(100) DEFAULT '' COMMENT '专家名称',
    `expert_avatar` VARCHAR(500) DEFAULT '' COMMENT '专家头像',
    `expert_title` VARCHAR(100) DEFAULT '' COMMENT '专家头衔',
    `message` VARCHAR(1000) DEFAULT '' COMMENT '申请说明',
    `status` TINYINT DEFAULT 0 COMMENT '状态:0=待确认,1=已选中,2=未选中,3=已完成',
    `rating` TINYINT DEFAULT 0 COMMENT '评分(1-5)',
    `review` VARCHAR(1000) DEFAULT '' COMMENT '评价内容',
    -- ==================== 标准审计字段 ====================
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL COMMENT '修改时间',
    `deleted_at` DATETIME NULL COMMENT '软删除时间',
    `create_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '创建人ID',
    `create_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '创建人姓名',
    `update_by` BIGINT UNSIGNED DEFAULT 0 NOT NULL COMMENT '修改人ID',
    `update_by_name` VARCHAR(20) DEFAULT '系统' NOT NULL COMMENT '修改人姓名',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_consult_expert` (`consult_id`, `expert_id`),
    KEY `idx_expert_id` (`expert_id`),
    KEY `idx_created_at` (`created_at`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='咨询申请表';
```

---

## 五、接口设计

### 5.1 接口总览

| 领域 | 模块 | 接口数量 | 路由前缀 |
|------|------|----------|----------|
| iam | 用户认证 | 10 | `/auth`, `/user` |
| master | 基础数据 | 7 | `/master/superDictionary` |
| master | 省市区 | 5 | `/master/region` |
| thinking | 思维模型 | 12 | `/thinking/model` |
| thinking | 模型分类 | 10 | `/thinking/category` |
| thinking | 课题管理 | 12 | `/thinking/topic` |
| thinking | 分析记录 | 10 | `/thinking/analysis` |
| thinking | 行动管理 | 10 | `/thinking/action` |
| thinking | 跟进记录 | 5 | `/thinking/followup` |
| ai | 对话会话 | 8 | `/ai/session` |
| ai | 模型配置 | 8 | `/ai/model` |
| ai | 用户配置 | 6 | `/ai/userConfig` |
| ai | 智能体 | 10 | `/ai/agent` |
| ai | Token统计 | 4 | `/ai/usage` |
| payment | 订单管理 | 14 | `/payment/order` |
| payment | 钱包账户 | 8 | `/payment/wallet` |
| payment | 结算管理 | 6 | `/payment/settlement` |
| community | 约见活动 | 10 | `/community/meetup` |
| community | 话题讨论 | 10 | `/community/discuss` |
| community | 付费咨询 | 10 | `/community/consult` |

### 5.2 iam 领域接口

#### 5.2.1 认证接口 `/auth`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | /auth/register | 用户注册 | 新用户注册账号 |
| 2 | POST | /auth/login | 用户登录 | 账号密码登录获取Token |
| 3 | POST | /auth/logout | 用户登出 | 清除登录状态 |
| 4 | POST | /auth/refresh | 刷新Token | 使用RefreshToken换取新Token |


#### 5.2.2 用户接口 `/user`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | GET | /user/info | 获取当前用户 | 获取登录用户详细信息 |
| 2 | POST | /user | 创建用户 | 管理员创建用户 |
| 3 | PUT | /user | 更新用户 | 更新用户信息 |
| 4 | GET | /user/:id | 获取用户详情 | 根据ID获取用户 |
| 5 | POST | /user/list | 用户列表 | 分页查询用户 |
| 6 | DELETE | /user | 删除用户 | 批量删除用户 |

### 5.3 master 领域接口

#### 5.3.1 超级字典接口 `/master/superDictionary`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 创建字典项 | 创建字典条目 |
| 2 | PUT | / | 更新字典项 | 更新字典条目 |
| 3 | GET | /:id | 获取字典详情 | 根据ID获取字典 |
| 4 | POST | /list | 字典列表 | 分页查询字典 |
| 5 | DELETE | / | 删除字典项 | 批量删除字典 |
| 6 | GET | /tree | 字典树 | 获取完整字典树 |
| 7 | POST | /children | 获取子级 | 获取指定节点子级 |

#### 5.3.2 省市区接口 `/master/region`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | GET | /list | 区域列表 | 获取所有区域 |
| 2 | GET | /tree | 区域树 | 获取省市区树形结构 |
| 3 | GET | /children/:parentId | 获取子级 | 获取指定区域子级 |
| 4 | GET | /provinces | 省份列表 | 获取所有省份 |
| 5 | GET | /cities/:provinceId | 城市列表 | 获取指定省份下的城市 |

### 5.4 thinking 领域接口（核心MVP）

#### 5.4.1 思维模型接口 `/thinking/model`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 创建模型 | 创建思维模型（草稿） |
| 2 | PUT | / | 更新模型 | 更新模型信息 |
| 3 | GET | /:id | 获取模型详情 | 根据ID获取模型 |
| 4 | GET | /code/:code | 根据编码获取 | 根据Code获取模型 |
| 5 | GET | /list | 模型列表 | 分页查询模型市场 |
| 6 | GET | /my | 我的模型 | 获取当前用户创建的模型 |
| 7 | DELETE | / | 删除模型 | 批量删除模型 |
| 8 | POST | /publish | 发布模型 | 提交审核发布 |
| 9 | POST | /unpublish | 下架模型 | 下架已发布模型 |
| 10 | POST | /status | 更新状态 | 审核通过/拒绝 |
| 11 | POST | /fork | 引用创建 | 基于模型创建副本 |
| 12 | POST | /like | 点赞模型 | 点赞/取消点赞 |

#### 5.4.2 模型分类接口 `/thinking/category`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 创建分类 | 创建模型分类 |
| 2 | PUT | / | 更新分类 | 更新分类信息 |
| 3 | GET | /:id | 获取分类详情 | 根据ID获取分类 |
| 4 | GET | /list | 分类列表 | 获取分类列表 |
| 5 | DELETE | / | 删除分类 | 删除分类 |
| 6 | GET | /tree | 分类树 | 获取分类树结构 |
| 7 | GET | /tree/all | 完整分类树 | 含根节点的分类树 |
| 8 | GET | /children/:id | 获取子分类 | 获取指定分类子级 |
| 9 | GET | /path/:id | 获取路径 | 获取分类完整路径 |
| 10 | POST | /move | 移动分类 | 调整分类位置 |

#### 5.4.3 课题接口 `/thinking/topic`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 创建课题 | 创建新课题 |
| 2 | PUT | / | 更新课题 | 更新课题信息 |
| 3 | GET | /:id | 获取课题详情 | 根据ID获取课题 |
| 4 | GET | /list | 课题列表 | 分页查询课题 |
| 5 | GET | /my | 我的课题 | 获取当前用户课题 |
| 6 | DELETE | / | 删除课题 | 批量删除课题 |
| 7 | POST | /status | 更新状态 | 更新课题状态 |
| 8 | POST | /select-model | 选用模型 | 为课题选用思维模型 |
| 9 | POST | /remove-model/:id | 移除模型 | 移除课题关联模型 |
| 10 | POST | /complete | 完成课题 | 标记课题完成 |
| 11 | POST | /archive | 归档课题 | 归档课题 |
| 12 | GET | /statistics | 课题统计 | 获取课题统计数据 |

#### 5.4.5 分析记录接口 `/thinking/analysis`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 创建分析 | 创建分析记录 |
| 2 | POST | /save-with-ai | AI分析 | 提交并调用AI分析 |
| 3 | PUT | / | 更新分析 | 更新分析内容 |
| 4 | GET | /:id | 分析详情 | 获取分析详情 |
| 5 | GET | /list | 分析列表 | 分页查询分析 |
| 6 | GET | /by-topic/:topicId | 课题分析列表 | 获取课题下的分析 |
| 7 | GET | /current | 当前版本 | 获取当前版本分析 |
| 8 | GET | /history/:topicId/:modelId | 历史版本 | 获取历史分析记录 |
| 9 | POST | /set-current | 设为当前 | 设置为当前版本 |
| 10 | DELETE | / | 删除分析 | 删除分析记录 |

#### 5.4.6 行动接口 `/thinking/action`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 创建行动 | 创建行动项 |
| 2 | POST | /from-analysis | 从分析导出 | 从分析结果导出行动 |
| 3 | PUT | / | 更新行动 | 更新行动信息 |
| 4 | GET | /:id | 行动详情 | 获取行动详情 |
| 5 | GET | /list | 行动列表 | 分页查询行动 |
| 6 | GET | /my | 我的行动 | 获取当前用户行动 |
| 7 | DELETE | / | 删除行动 | 批量删除行动 |
| 8 | POST | /progress | 更新进度 | 更新行动完成进度 |
| 9 | POST | /complete | 完成行动 | 标记行动完成 |
| 10 | GET | /statistics | 行动统计 | 获取行动统计数据 |

#### 5.4.7 跟进记录接口 `/thinking/followup`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 添加跟进 | 添加跟进记录 |
| 2 | GET | /:id | 跟进详情 | 获取跟进详情 |
| 3 | GET | /by-action/:actionId | 行动跟进列表 | 获取行动的跟进记录 |
| 4 | PUT | / | 更新跟进 | 更新跟进内容 |
| 5 | DELETE | /:id | 删除跟进 | 删除跟进记录 |

### 5.5 ai 领域接口（AI对话基础设施）

#### 5.5.1 对话会话接口 `/ai/session`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 创建会话 | 创建新对话会话 |
| 2 | PUT | / | 更新会话 | 更新会话信息（标题等） |
| 3 | GET | /:id | 会话详情 | 获取会话详情及消息历史 |
| 4 | GET | /list | 会话列表 | 获取用户会话列表 |
| 5 | DELETE | /:id | 删除会话 | 删除对话会话 |
| 6 | POST | /archive/:id | 归档会话 | 归档会话 |
| 7 | POST | /chat | 发送消息 | 发送消息并获取AI回复 |
| 8 | POST | /chat/stream | 流式对话 | 流式发送消息(SSE) |

#### 5.5.2 模型配置接口 `/ai/model`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 创建配置 | 创建系统模型配置(管理员) |
| 2 | PUT | / | 更新配置 | 更新模型配置 |
| 3 | GET | /:id | 配置详情 | 获取模型配置详情 |
| 4 | GET | /list | 配置列表 | 获取可用模型列表 |
| 5 | DELETE | /:id | 删除配置 | 删除模型配置 |
| 6 | GET | /providers | 提供商列表 | 获取支持的模型提供商 |
| 7 | POST | /test | 测试连接 | 测试模型配置是否可用 |
| 8 | POST | /set-default/:id | 设为默认 | 设置默认模型 |

#### 5.5.3 用户AI配置接口 `/ai/userConfig`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 添加配置 | 用户添加自定义模型配置 |
| 2 | PUT | / | 更新配置 | 更新用户模型配置 |
| 3 | GET | /my | 我的配置 | 获取用户自定义模型列表 |
| 4 | DELETE | /:id | 删除配置 | 删除用户模型配置 |
| 5 | POST | /test | 测试配置 | 测试用户配置是否可用 |
| 6 | POST | /set-default/:id | 设为默认 | 设置用户默认模型 |

#### 5.5.4 智能体接口 `/ai/agent`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 创建智能体 | 创建智能体配置 |
| 2 | PUT | / | 更新智能体 | 更新智能体配置 |
| 3 | GET | /:id | 智能体详情 | 获取智能体详情 |
| 4 | GET | /list | 智能体列表 | 获取可用智能体列表 |
| 5 | GET | /my | 我的智能体 | 获取我创建的智能体 |
| 6 | DELETE | /:id | 删除智能体 | 删除智能体 |
| 7 | POST | /publish/:id | 发布智能体 | 发布公开智能体 |
| 8 | POST | /unpublish/:id | 下架智能体 | 下架智能体 |
| 9 | GET | /by-scene/:scene | 场景智能体 | 获取特定场景智能体 |
| 10 | POST | /test/:id | 测试智能体 | 测试智能体对话 |

#### 5.5.5 Token统计接口 `/ai/usage`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | GET | /my | 我的用量 | 获取当前用户Token用量统计 |
| 2 | GET | /daily | 每日统计 | 获取每日Token消耗 |
| 3 | GET | /by-model | 模型统计 | 按模型统计Token消耗 |
| 4 | GET | /logs | 调用日志 | 获取AI调用详细日志 |

### 5.6 payment 领域接口（支付中心）

#### 5.6.1 订单接口 `/payment/order`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 创建订单 | 创建购买订单 |
| 2 | GET | /:id | 订单详情 | 获取订单详情 |
| 3 | GET | /no/:orderNo | 根据编号查询 | 根据订单号查询 |
| 4 | GET | /my | 我的订单 | 获取我的订单列表 |
| 5 | POST | /pay | 支付订单 | 发起订单支付 |
| 6 | POST | /cancel/:id | 取消订单 | 取消未支付订单 |
| 7 | POST | /refund/:id | 申请退款 | 申请订单退款 |
| 8 | GET | /income | 收益统计 | 获取创作者收益统计 |
| 9 | GET | /sales | 销售统计 | 获取销售数据统计 |
| 10 | POST | /callback/:channel | 支付回调 | 支付渠道回调接口 |
| 11 | POST | /adopt | 采纳模型 | 采纳模型（免费立即完成，付费需支付） |
| 12 | GET | /adopted | 我的模型库 | 获取已采纳的模型列表 |
| 13 | GET | /check-adopt/:modelId | 检查采纳 | 检查是否已采纳某模型 |
| 14 | POST | /hide/:id | 隐藏订单 | 从模型库隐藏（移除采纳） |

#### 5.6.2 钱包接口 `/payment/wallet`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | GET | /my | 我的钱包 | 获取钱包账户信息 |
| 2 | GET | /balance | 余额查询 | 查询可用余额 |
| 3 | POST | /recharge | 充值 | 钱包充值 |
| 4 | POST | /withdraw | 提现申请 | 申请提现 |
| 5 | GET | /transactions | 交易流水 | 获取交易流水记录 |
| 6 | GET | /transactions/:id | 流水详情 | 获取流水详情 |
| 7 | POST | /set-password | 设置密码 | 设置支付密码 |
| 8 | POST | /verify-password | 验证密码 | 验证支付密码 |

#### 5.6.3 结算接口 `/payment/settlement`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | GET | /my | 我的结算 | 获取我的结算记录 |
| 2 | GET | /:id | 结算详情 | 获取结算单详情 |
| 3 | POST | /apply | 申请结算 | 手动申请结算 |
| 4 | GET | /pending | 待结算 | 查询待结算金额 |
| 5 | POST | /bindBank | 绑定账户 | 绑定收款银行账户 |
| 6 | GET | /bankInfo | 账户信息 | 获取绑定的银行账户 |

### 5.7 community 领域接口（可扩展）

#### 5.7.1 约见接口 `/community/meetup`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 发起约见 | 创建约见活动 |
| 2 | PUT | / | 更新约见 | 更新约见信息 |
| 3 | GET | /:id | 约见详情 | 获取约见详情 |
| 4 | GET | /list | 约见列表 | 分页查询约见 |
| 5 | GET | /my | 我的约见 | 获取我发起的约见 |
| 6 | DELETE | /:id | 取消约见 | 取消约见活动 |
| 7 | POST | /apply | 报名约见 | 报名参与约见 |
| 8 | POST | /confirm | 确认报名 | 确认报名者 |
| 9 | POST | /reject | 拒绝报名 | 拒绝报名者 |
| 10 | POST | /interest | 感兴趣 | 标记感兴趣 |

#### 5.7.2 话题讨论接口 `/community/discuss`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 发布话题 | 创建话题讨论 |
| 2 | PUT | / | 更新话题 | 更新话题内容 |
| 3 | GET | /:id | 话题详情 | 获取话题详情 |
| 4 | GET | /list | 话题列表 | 分页查询话题 |
| 5 | GET | /my | 我的话题 | 获取我发布的话题 |
| 6 | DELETE | /:id | 删除话题 | 删除话题 |
| 7 | POST | /like | 点赞话题 | 点赞/取消点赞 |
| 8 | POST | /collect | 收藏话题 | 收藏/取消收藏 |
| 9 | POST | /comment | 发表评论 | 发表话题评论 |
| 10 | GET | /comments/:id | 评论列表 | 获取话题评论 |

#### 5.7.3 付费咨询接口 `/community/consult`

| 序号 | 方法 | 路径 | 接口名称 | 说明 |
|------|------|------|----------|------|
| 1 | POST | / | 发布咨询 | 创建咨询需求 |
| 2 | PUT | / | 更新咨询 | 更新咨询信息 |
| 3 | GET | /:id | 咨询详情 | 获取咨询详情 |
| 4 | GET | /list | 咨询列表 | 分页查询咨询 |
| 5 | GET | /my | 我的咨询 | 获取我发布的咨询 |
| 6 | DELETE | /:id | 取消咨询 | 取消咨询 |
| 7 | POST | /apply | 申请咨询 | 专家申请接单 |
| 8 | POST | /select | 选择专家 | 选择申请的专家 |
| 9 | POST | /complete | 完成咨询 | 标记咨询完成 |
| 10 | POST | /review | 评价咨询 | 评价专家服务 |

---

## 六、接口与业务模型能力编排

### 6.1 编排设计原则

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              接口编排流程                                       │
└─────────────────────────────────────────────────────────────────────────────────┘

    请求层              业务层              领域层              数据层
┌──────────┐      ┌──────────┐      ┌──────────┐      ┌──────────┐
│   API    │ ---> │  Logic   │ ---> │  Entity  │ ---> │    DB    │
│ 参数校验 │      │ 业务编排 │      │ 业务能力 │      │ 数据持久 │
│ 响应封装 │      │ 事务控制 │      │ 领域规则 │      │          │
└──────────┘      └──────────┘      └──────────┘      └──────────┘
```

### 6.2 核心接口编排说明

#### 6.2.1 用户登录 `POST /auth/login`

```
Logic: UserLogic.Login()
编排流程:
├─ 1. UserEntity.LoadByUsername()     # 根据用户名查询用户
├─ 2. UserEntity.VerifyPassword()     # 验证密码（充血模型能力）
├─ 3. UserEntity.GenerateToken()      # 生成JWT Token对（充血模型能力）
└─ 4. UserEntity.UpdateLoginInfo()    # 更新登录时间和IP
```

#### 6.2.2 创建思维模型 `POST /market/model`

```
Logic: ModelLogic.Create()
编排流程:
├─ 1. ModelEntity.SetData(req)        # 数据赋值
├─ 2. ModelEntity.Validate()          # 数据校验（名称、分类、内容）
├─ 3. ModelEntity.Repair()            # 数据修复（默认版本、难度）
├─ 4. CategoryEntity.LoadById()       # 校验分类存在性
├─ 5. ModelEntity.Create()            # 持久化保存
└─ 6. ModelTagEntity.BatchCreate()    # 批量创建标签关联
```

#### 6.2.3 发布模型 `POST /market/model/publish`

```
Logic: ModelLogic.Publish()
编排流程:
├─ 1. ModelEntity.LoadById()          # 加载模型数据
├─ 2. ModelEntity.Validate()          # 发布前完整性校验
├─ 3. ModelEntity.Publish()           # 设置发布状态和时间（充血模型能力）
├─ 4. ModelEntity.Update()            # 更新数据
└─ 5. CategoryEntity.IncrementCount() # 更新分类下模型数量
```

#### 6.2.4 采纳模型 `POST /payment/order/adopt`

```
Logic: OrderLogic.AdoptModel()
编排流程:
├─ 1. ModelEntity.LoadById()          # 加载模型信息
├─ 2. OrderEntity.CheckExist()        # 检查是否已采纳（同用户同模型是否有已完成订单）
├─ 3. OrderEntity.Create()            # 创建订单（免费模型金额=0）
│     ├─ OrderEntity.SetData()
│     ├─ OrderEntity.SetOrderType(1)  # 设为模型采纳类型
│     └─ OrderEntity.CalculateFee()   # 计算平台费和卖家收入
├─ 4. [免费模型] 直接完成
│     └─ OrderEntity.MarkCompleted()  # 金额为0直接标记完成
├─ 5. [付费模型] 进入支付流程
│     ├─ 调用支付服务
│     └─ OrderEntity.MarkPaid()       # 支付成功后标记
└─ 6. ModelEntity.IncrementAdoptCount() # 更新采纳统计
```

#### 6.2.5 创建课题 `POST /subject/topic`

```
Logic: TopicLogic.Create()
编排流程:
├─ 1. TopicEntity.SetData(req)        # 数据赋值（标题、描述、背景、目标）
├─ 2. TopicEntity.Validate()          # 数据校验
├─ 3. TopicEntity.Repair()            # 数据修复（默认状态、优先级）
├─ 4. TopicEntity.SetTags()           # 设置标签（充血模型能力）
└─ 5. TopicEntity.Create()            # 持久化保存
```

#### 6.2.6 选用模型分析 `POST /subject/topic/select-model`

```
Logic: TopicLogic.SelectModel()
编排流程:
├─ 1. TopicEntity.LoadById()          # 加载课题
├─ 2. ModelEntity.LoadById()          # 加载模型
├─ 3. OrderEntity.CheckAdopted()      # 检查用户是否已采纳该模型（订单是否存在且已完成）
├─ 4. TopicEntity.SelectModel()       # 关联模型（充血模型能力）
├─ 5. TopicEntity.Update()            # 更新课题
└─ 6. ModelEntity.IncrementUsageCount() # 更新使用统计
```

#### 6.2.7 AI分析 `POST /subject/analysis/save-with-ai`

```
Logic: AnalysisLogic.SaveWithAi()
编排流程:
├─ 1. TopicEntity.LoadById()          # 加载课题信息
├─ 2. ModelEntity.LoadById()          # 加载模型内容
├─ 3. AnalysisEntity.SetData(req)     # 设置分析输入
├─ 4. AnalysisEntity.Validate()       # 校验内容格式
├─ 5. [异步] AI服务调用              # 调用AI分析接口
├─ 6. AnalysisEntity.UpdateAiResult() # 更新AI分析结果（充血模型能力）
├─ 7. AnalysisEntity.SetAsCurrent()   # 设为当前版本（充血模型能力）
├─ 8. AnalysisEntity.Create()         # 保存分析记录
└─ 9. TopicEntity.IncrementAnalysisCount() # 更新分析次数
```

#### 6.2.8 从分析导出行动 `POST /action/from-analysis`

```
Logic: ActionLogic.CreateFromAnalysis()
编排流程:
├─ 1. AnalysisEntity.LoadById()       # 加载分析记录
├─ 2. AnalysisEntity.ParseContent()   # 解析分析内容（充血模型能力）
├─ 3. TopicEntity.LoadById()          # 加载课题信息
├─ 4. [循环] 创建行动项
│     ├─ ActionEntity.SetData()       # 设置行动数据
│     ├─ ActionEntity.SetGuidePrinciple() # 设置指导原则
│     └─ ActionEntity.Create()        # 保存行动
└─ 5. TopicEntity.IncrementActionCount() # 更新导出行动数
```

#### 6.2.9 更新行动进度 `POST /thinking/action/progress`

```
Logic: ActionLogic.UpdateProgress()
编排流程:
├─ 1. ActionEntity.LoadById()         # 加载行动
├─ 2. ActionEntity.UpdateProgress()   # 更新进度（充血模型能力）
├─ 3. ActionEntity.Update()           # 保存更新
├─ 4. FollowUpEntity.Create()         # 自动创建跟进记录
│     ├─ FollowUpEntity.SetData()
│     └─ FollowUpEntity.Create()
└─ 5. ActionEntity.IncrementFollowupCount() # 更新跟进数
```

#### 6.2.10 创建AI对话会话 `POST /ai/session`

```
Logic: ChatSessionLogic.Create()
编排流程:
├─ 1. UserEntity.LoadById()           # 加载用户信息
├─ 2. [可选] AiModelConfigEntity.LoadDefault() # 加载默认模型配置
├─ 3. [可选] AgentEntity.LoadById()   # 加载智能体配置
├─ 4. ChatSessionEntity.SetData(req)  # 数据赋值
├─ 5. ChatSessionEntity.SetSystemPrompt() # 设置系统提示词
├─ 6. ChatSessionEntity.SetContext()  # 设置上下文（关联课题/模型等）
└─ 7. ChatSessionEntity.Create()      # 保存会话
```

#### 6.2.11 发送AI对话消息 `POST /ai/session/chat`

```
Logic: ChatSessionLogic.Chat()
编排流程:
├─ 1. ChatSessionEntity.LoadById()    # 加载会话信息
├─ 2. ChatMessageEntity.Create()      # 保存用户消息
│     ├─ ChatMessageEntity.SetRole("user")
│     └─ ChatMessageEntity.Create()
├─ 3. AiModelConfigEntity.LoadById()  # 加载模型配置
│     └─ [或] UserAiConfigEntity.LoadById() # 用户自定义配置
├─ 4. ChatLogEntity.PrepareRequest()  # 准备请求日志
├─ 5. AI调用（eino框架）
│     ├─ 构建上下文消息
│     ├─ 调用AI模型API
│     └─ 记录响应Token消耗
├─ 6. ChatMessageEntity.Create()      # 保存AI回复消息
│     ├─ ChatMessageEntity.SetRole("assistant")
│     └─ ChatMessageEntity.SetTokenUsage()
├─ 7. ChatLogEntity.Create()          # 保存完整调用日志
├─ 8. ChatSessionEntity.UpdateTokenUsage() # 更新会话Token累计
└─ 9. UserTokenUsageEntity.Increment() # 更新用户Token统计
```

#### 6.2.12 配置用户自定义AI模型 `POST /ai/userConfig`

```
Logic: UserAiConfigLogic.Create()
编排流程:
├─ 1. UserEntity.LoadById()           # 验证用户
├─ 2. UserAiConfigEntity.SetData(req) # 数据赋值
├─ 3. UserAiConfigEntity.EncryptApiKey() # 加密API Key（安全处理）
├─ 4. UserAiConfigEntity.TestConnection() # 测试API连接可用性
│     ├─ 发送测试请求
│     └─ 验证响应
├─ 5. UserAiConfigEntity.Validate()   # 校验配置完整性
└─ 6. UserAiConfigEntity.Create()     # 保存配置
```

#### 6.2.13 创建订单支付 `POST /payment/order/pay`

```
Logic: OrderLogic.Pay()
编排流程:
├─ 1. OrderEntity.LoadById()          # 加载订单信息
├─ 2. OrderEntity.CheckPayable()      # 检查是否可支付（充血模型能力）
├─ 3. [可选] WalletEntity.LoadByUserId() # 加载用户钱包（余额支付）
├─ 4. 支付处理
│     ├─ [余额支付] WalletEntity.Deduct() # 扣减余额
│     │   └─ WalletTransactionEntity.Create() # 创建交易记录
│     └─ [第三方支付] 调用支付网关
│         ├─ 创建支付预单
│         └─ 返回支付参数
├─ 5. OrderEntity.MarkPaid()          # 标记已支付
└─ 6. OrderEntity.Update()            # 保存订单状态
```

#### 6.2.14 订单完成后结算 `回调处理`

```
Logic: OrderLogic.Complete() + SettlementLogic.Process()
编排流程:
├─ 1. OrderEntity.LoadById()          # 加载订单
├─ 2. OrderEntity.MarkCompleted()     # 标记完成
├─ 3. 结算处理（T+7延迟）
│     ├─ SettlementEntity.Create()    # 创建结算记录
│     │   ├─ 计算平台服务费
│     │   └─ 计算卖家收入
│     └─ SettlementEntity.SetPending() # 设为待结算状态
├─ 4. [自动结算任务] 到期后执行
│     ├─ WalletEntity.LoadByUserId()  # 加载卖家钱包
│     ├─ WalletEntity.Increase()      # 增加余额
│     ├─ WalletTransactionEntity.Create() # 创建收入流水
│     └─ SettlementEntity.MarkCompleted() # 标记结算完成
└─ 5. 通知卖家收益到账
```

#### 6.2.15 发起约见 `POST /community/meetup`

```
Logic: MeetupLogic.Create()
编排流程:
├─ 1. UserEntity.LoadById()           # 加载发起人信息
├─ 2. MeetupEntity.SetData(req)       # 数据赋值
├─ 3. MeetupEntity.SetUserInfo()      # 设置发起人信息快照
├─ 4. MeetupEntity.Validate()         # 校验（城市、时间、人数）
├─ 5. [可选] ModelEntity.LoadById()   # 加载关联模型
└─ 6. MeetupEntity.Create()           # 保存约见
```

---

## 七、目录结构规划

```
backend/
├── api/
│   ├── iam/
│   │   └── user.go
│   ├── master/
│   │   ├── superDictionary.go
│   │   └── region.go                 # 省市区
│   ├── thinking/                     # 核心MVP领域
│   │   ├── model.go                  # 思维模型
│   │   ├── category.go               # 模型分类
│   │   ├── topic.go                  # 课题管理
│   │   ├── analysis.go               # 分析记录
│   │   ├── action.go                 # 行动管理
│   │   └── followup.go               # 跟进记录
│   ├── ai/                       # AI对话基础设施
│   │   ├── session.go                # 对话会话
│   │   ├── model.go                  # 模型配置
│   │   ├── userConfig.go             # 用户配置
│   │   ├── agent.go                  # 智能体
│   │   └── usage.go                  # Token统计
│   ├── payment/                      # 支付中心
│   │   ├── order.go                  # 订单管理
│   │   ├── wallet.go                 # 钱包账户
│   │   └── settlement.go             # 结算管理
│   └── community/                    # 社群（可扩展）
│       ├── meetup.go
│       ├── discuss.go
│       └── consult.go
├── domain/
│   ├── iam/
│   │   └── user/
│   │       ├── model.go
│   │       ├── types.go
│   │       └── abilitys.go
│   ├── master/
│   │   ├── superDictionary/
│   │   └── region/                   # 省市区
│   ├── thinking/                     # 核心MVP领域
│   │   ├── model/
│   │   ├── category/
│   │   ├── tag/
│   │   ├── comment/
│   │   ├── topic/
│   │   ├── analysis/
│   │   ├── action/
│   │   └── followup/
│   ├── ai/                       # AI对话基础设施
│   │   ├── session/
│   │   ├── message/
│   │   ├── log/
│   │   ├── modelConfig/
│   │   ├── userConfig/
│   │   ├── agent/
│   │   └── tokenUsage/
│   ├── payment/                      # 支付中心
│   │   ├── order/
│   │   ├── wallet/
│   │   ├── transaction/
│   │   └── settlement/
│   └── community/                    # 社群（可扩展）
│       ├── meetup/
│       ├── meetupApply/
│       ├── discuss/
│       ├── discussComment/
│       ├── consult/
│       └── consultApply/
├── logic/
│   ├── iam/
│   │   └── user.go
│   ├── master/
│   │   ├── superDictionary.go
│   │   └── region.go                 # 省市区
│   ├── thinking/                     # 核心MVP领域
│   │   ├── model.go
│   │   ├── category.go
│   │   ├── topic.go
│   │   ├── analysis.go
│   │   ├── action.go
│   │   └── followup.go
│   ├── ai/                       # AI对话基础设施
│   │   ├── session.go
│   │   ├── modelConfig.go
│   │   ├── userConfig.go
│   │   ├── agent.go
│   │   └── usage.go
│   ├── payment/                      # 支付中心
│   │   ├── order.go
│   │   ├── wallet.go
│   │   └── settlement.go
│   └── community/                    # 社群（可扩展）
│       ├── meetup.go
│       ├── discuss.go
│       └── consult.go
└── router/
    └── v1.go
```

---

## 八、开发优先级建议

### 8.1 第一阶段：核心闭环（MVP）

| 优先级 | 模块 | 功能 | 预估工时 |
|--------|------|------|----------|
| P0 | iam | 用户注册、登录、Token管理 | 已完成 |
| P0 | master | 超级字典 | 已完成 |
| P0 | thinking | 模型CRUD、分类管理 | 部分完成 |
| P0 | thinking | 课题CRUD、分析记录 | 部分完成 |
| P1 | thinking | 模型采纳（免费） | 3天 |
| P1 | thinking | 行动CRUD、跟进记录 | 5天 |

### 8.2 第二阶段：AI对话与支付

| 优先级 | 模块 | 功能 | 预估工时 |
|--------|------|------|----------|
| P1 | ai | 对话会话、消息管理 | 5天 |
| P1 | ai | 模型配置（系统+用户自定义） | 3天 |
| P1 | ai | Token统计与消耗记录 | 2天 |
| P1 | ai | 智能体配置（eino框架） | 5天 |
| P1 | payment | 订单管理、支付流程 | 5天 |
| P1 | payment | 钱包账户、交易流水 | 3天 |
| P2 | payment | 结算管理、提现功能 | 3天 |

### 8.3 第三阶段：社群与运营

| 优先级 | 模块 | 功能 | 预估工时 |
|--------|------|------|----------|
| P2 | community | 话题讨论 | 5天 |
| P2 | community | 约见活动 | 5天 |
| P2 | community | 付费咨询 | 5天 |
| P3 | thinking | 评论、点赞、标签系统 | 3天 |
| P3 | community | 专家认证、评价体系 | 3天 |
| P3 | 全局 | 数据统计、运营后台 | 5天 |

---

## 九、附录

### 9.1 状态枚举定义

```go
// 模型状态
const (
    ModelStatusDraft    = 0 // 草稿
    ModelStatusPending  = 1 // 审核中
    ModelStatusPublished = 2 // 已发布
    ModelStatusOffline  = 3 // 已下架
    ModelStatusRejected = 4 // 审核拒绝
)

// 课题状态
const (
    TopicStatusDraft     = 0 // 草稿
    TopicStatusActive    = 1 // 进行中
    TopicStatusCompleted = 2 // 已完成
    TopicStatusArchived  = 3 // 已归档
)

// 行动状态
const (
    ActionStatusPending    = 0 // 待执行
    ActionStatusInProgress = 1 // 进行中
    ActionStatusCompleted  = 2 // 已完成
    ActionStatusCancelled  = 3 // 已取消
)

// 对话会话状态
const (
    ChatSessionStatusArchived = 0 // 已归档
    ChatSessionStatusActive   = 1 // 活跃
)

// 对话消息状态
const (
    ChatMessageStatusFailed     = 0 // 失败
    ChatMessageStatusSuccess    = 1 // 成功
    ChatMessageStatusGenerating = 2 // 生成中
)

// 智能体状态
const (
    AgentStatusDisabled = 0 // 禁用
    AgentStatusEnabled  = 1 // 启用
)

// 订单状态
const (
    OrderStatusPending   = 0 // 待支付
    OrderStatusPaid      = 1 // 已支付
    OrderStatusCompleted = 2 // 已完成
    OrderStatusRefunded  = 3 // 已退款
    OrderStatusCancelled = 4 // 已取消
    OrderStatusFailed    = 5 // 支付失败
)

// 订单类型
const (
    OrderTypeModelPurchase = 1 // 模型购买
    OrderTypeConsultation  = 2 // 付费咨询
    OrderTypeRecharge      = 3 // 余额充值
    OrderTypeTokenPurchase = 4 // Token购买
)

// 钱包交易类型
const (
    WalletTransactionTypeRecharge = 1 // 充值
    WalletTransactionTypeConsume  = 2 // 消费
    WalletTransactionTypeIncome   = 3 // 收入
    WalletTransactionTypeWithdraw = 4 // 提现
    WalletTransactionTypeRefund   = 5 // 退款
    WalletTransactionTypeFreeze   = 6 // 冻结
    WalletTransactionTypeUnfreeze = 7 // 解冻
)

// 结算状态
const (
    SettlementStatusPending  = 0 // 待审核
    SettlementStatusApproved = 1 // 审核通过
    SettlementStatusPaid     = 2 // 已打款
    SettlementStatusCompleted = 3 // 已完成
    SettlementStatusRejected = 4 // 已拒绝
)

// 咨询状态
const (
    ConsultStatusRecruiting = 0 // 征集中
    ConsultStatusMatched    = 1 // 已匹配
    ConsultStatusInProgress = 2 // 进行中
    ConsultStatusCompleted  = 3 // 已完成
    ConsultStatusCancelled  = 4 // 已取消
    ConsultStatusExpired    = 5 // 已过期
)
```

### 9.2 AI模型提供商配置

| 提供商 | 标识 | 支持模型示例 | 说明 |
|--------|------|--------------|------|
| OpenAI | openai | gpt-4o, gpt-4o-mini, gpt-3.5-turbo | 官方API |
| Anthropic | anthropic | claude-3-5-sonnet, claude-3-haiku | 官方API |
| Azure | azure | gpt-4o (azure部署) | Azure OpenAI服务 |
| DeepSeek | deepseek | deepseek-chat, deepseek-coder | 国产大模型 |
| 字节火山 | doubao | doubao-pro, doubao-lite | 字节跳动 |
| 自定义 | custom | - | 用户自定义兼容OpenAI接口的模型 |

### 9.3 平台费率配置

| 交易类型 | 平台服务费 | 卖家收入 |
|----------|------------|----------|
| 付费模型购买 | 20% | 80% |
| 付费咨询 | 15% | 85% |
| 结算周期 | T+7 | - |

---

**技术方案文档完成。**